<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0" />
  <title>Tech Taboo</title>
  <link rel="stylesheet" href="./assets/styles/rules.css" />
  <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
</head>

<body x-cloak x-data="{ 
    pageTitle: 'ðŸŽ¯ Tech Taboo', 
    decks: [],
    selectedDeck: localStorage.getItem('selectedDeck') || '',
    timerDuration: localStorage.getItem('timerDuration') || '120'
  }" x-init="
    /* Load partials only here */
    Promise.all([
      fetch('./partials/header.html').then(r => r.text()),
      fetch('./partials/footer.html').then(r => r.text()),
      fetch('./assets/hint.svg').then(r => r.text())
    ]).then(([h, f, s]) => {
      $refs.header.innerHTML = h;
      $refs.footer.innerHTML = f;
      $refs.svg.innerHTML = s;
    });">

  <div class="header-slot" x-ref="header">
  </div>

  <main class="app-main">
    <div class="rules-container">
      <!-- SVG -->
      <div class="svg-slot" x-ref="svg"></div>
      <!-- RULES -->
      <ol class="rules">
        <li>One person <strong>explains</strong> the word on screen.</li>
        <li>Do <span class="highlight">NOT</span> use the <span class="forbidden">forbidden</span> words.</li>
        <li>The audience <strong>guesses</strong> the term.</li>
        <li>If a forbidden word is spoken â†’ <span class="highlight">skip the card</span>.</li>
        <li>Hints and analogies are allowed. Buzzwords are not.</li>
      </ol>
    </div>
    <!-- SETTINGS -->
    <div class="settings">
      <div class="setting">
        <label for="deckSelect">Choose deck</label>
        <div class="select-wrapper">
          <select id="deckSelect" x-model="$store.game.selectedDeck" @change="$store.game.setDeck($event.target.value)">
            <template x-for="deck in $store.game.decks" :key="deck.key">
              <option :value="deck.key" x-text="deck.name" :selected="deck.key === $store.game.selectedDeck"></option>
            </template>
          </select>
        </div>
      </div>
      <div class="setting">
        <label for="timerSelect">Timer duration</label>
        <select id="timerSelect" x-model="$store.game.timerDuration"
          @change="$store.game.setTimer($event.target.value)">
          <option value="30">30 seconds</option>
          <option value="60">1 minute</option>
          <option value="120">2 minutes</option>
        </select>
      </div>
    </div>
    <!-- START -->
    <a class="start-game" href="./taboo.html" id="startGame">
      Start Game
    </a>
  </main>

  <div class="footer-slot" x-ref="footer"></div>
  <script type="text/javascript" defer>
    document.addEventListener('alpine:init', () => {
      Alpine.store('game', {
        selectedDeck: localStorage.getItem('selectedDeck') || '',
        timerDuration: localStorage.getItem('timerDuration') || '120',
        decks: [],

        async init() {
          try {
            const response = await fetch('./assets/decks/index.json');
            const data = await response.json();
            this.decks = data.decks;

            // Ensure current selection is valid or set default
            if (!this.selectedDeck && this.decks.length > 0) {
              this.selectedDeck = this.decks[0].key;
            }
          } catch (e) {
            console.error("Failed to load decks", e);
          }
        },

        setDeck(val) {
          this.selectedDeck = val;
          localStorage.setItem('selectedDeck', val);
        },

        setTimer(val) {
          this.timerDuration = val;
          localStorage.setItem('timerDuration', val);
        }
      });
    });
  </script>
</body>

</html>